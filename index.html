<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Constelación Mathema</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #0a0a0a;
      overflow: hidden;
      font-family: 'Quicksand', sans-serif;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    .modal {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(8px);
      background: rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      font-size: 1.5em;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal.error h1 {
      color: red;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }

    .button {
      margin-top: 20px;
      background: #f9b642;
      border: none;
      padding: 10px 20px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 1em;
      cursor: pointer;
      border-radius: 8px;
    }

    .subtitle {
      margin-top: 10px;
      font-size: 1em;
    }
  </style>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Quicksand&display=swap" rel="stylesheet">
</head>
<body>

<canvas id="canvas"></canvas>

<div id="modal" class="modal">
  <h1 id="message"></h1>
  <div class="subtitle" id="subtitle"></div>
  <button class="button" onclick="location.reload()">Reintentar</button>
</div>

<script>
// Canvas setup
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
resizeCanvas();

window.addEventListener('resize', resizeCanvas);

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  drawPoints();
}

// Configuración de puntos
const points = [];
const totalPoints = 15;
const radius = Math.min(canvas.width, canvas.height) / 3;
const centerX = canvas.width / 2;
const centerY = canvas.height / 2;

// Generar puntos en forma de pentágono + estrella
for (let i = 0; i < totalPoints; i++) {
  const angle = (i * (Math.PI * 2)) / totalPoints;
  const r = (i % 2 === 0) ? radius : radius / 2; // alterna grande y pequeño
  const x = centerX + r * Math.cos(angle - Math.PI/2);
  const y = centerY + r * Math.sin(angle - Math.PI/2);
  points.push({x, y});
}

let drawnPoints = [];
let isDrawing = false;
let isFinished = false;
let correctSequence = true;

// Dibujar puntos
function drawPoints() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  points.forEach((p, index) => {
    // borde neon
    ctx.beginPath();
    ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
    ctx.fillStyle = 'white';
    ctx.shadowColor = 'cyan';
    ctx.shadowBlur = 15;
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Número encima
    ctx.fillStyle = 'white';
    ctx.font = '16px Quicksand';
    ctx.fillText(index + 1, p.x - 5, p.y - 15);
  });

  drawLines();
}

// Dibujar líneas
function drawLines(color='white') {
  if (drawnPoints.length < 2) return;
  ctx.beginPath();
  ctx.moveTo(points[drawnPoints[0]].x, points[drawnPoints[0]].y);
  for (let i = 1; i < drawnPoints.length; i++) {
    ctx.lineTo(points[drawnPoints[i]].x, points[drawnPoints[i]].y);
  }
  ctx.strokeStyle = color;
  ctx.lineWidth = 2;
  ctx.stroke();
}

// Evento de clic
canvas.addEventListener('click', (e) => {
  if (isFinished) return;

  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  points.forEach((p, index) => {
    if (Math.hypot(p.x - mouseX, p.y - mouseY) < 15) {
      if (!drawnPoints.includes(index)) {
        drawnPoints.push(index);
        if (index !== drawnPoints.length - 1) correctSequence = false;
        drawPoints();
        if (drawnPoints.length === totalPoints) {
          finish();
        }
      }
    }
  });
});

// Finalizar partida
function finish() {
  isFinished = true;
  if (correctSequence) {
    animateLineToPink();
    setTimeout(() => {
      showModal(true);
      launchConfetti();
    }, 3000);
  } else {
    setTimeout(() => {
      showModal(false);
    }, 1000);
  }
}

// Animar transición blanca → rosa
function animateLineToPink() {
  let t = 0;
  const animation = setInterval(() => {
    const color = `rgb(${255}, ${Math.floor(255 * t)}, ${255})`;
    drawPoints();
    drawLines(color);
    t += 0.02;
    if (t >= 1) clearInterval(animation);
  }, 30);
}

// Mostrar modal
function showModal(success) {
  const modal = document.getElementById('modal');
  const message = document.getElementById('message');
  const subtitle = document.getElementById('subtitle');
  if (success) {
    message.textContent = '¡Misión completada con éxito!';
    subtitle.textContent = 'La constelación Mathema reactivada';
    modal.classList.add('show');
  } else {
    message.textContent = 'ERROR';
    subtitle.textContent = 'La constelación Mathema no reactivada';
    modal.classList.add('show', 'error');
  }
}

// Mini confeti
function launchConfetti() {
  const duration = 2 * 1000;
  const end = Date.now() + duration;
  
  (function frame() {
    confetti({
      particleCount: 5,
      angle: 60,
      spread: 55,
      origin: { x: 0 }
    });
    confetti({
      particleCount: 5,
      angle: 120,
      spread: 55,
      origin: { x: 1 }
    });
    if (Date.now() < end) {
      requestAnimationFrame(frame);
    }
  }());
}

// Ligero confetti script
(function(){var t=window.confetti=function(t){var e=document.createElement("canvas");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",document.body.appendChild(e);var n=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;var o=[],r=0;function i(){r+=.01,n.clearRect(0,0,e.width,e.height),o=o.filter(t=>t.y<e.height);for(var t=0;t<o.length;t++)o[t].y+=o[t].dy,o[t].x+=o[t].dx,o[t].r+=o[t].dr,n.fillStyle=o[t].color,n.beginPath(),n.arc(o[t].x,o[t].y,3,0,2*Math.PI),n.fill();requestAnimationFrame(i)}window.addEventListener("resize",()=>{e.width=window.innerWidth,e.height=window.innerHeight}),i(),setInterval(function(){var e=t||{};o.push({x:(e.origin?.x||Math.random())*window.innerWidth,y:(e.origin?.y||Math.random())*window.innerHeight,dx:Math.random()*4-2,dy:Math.random()*-3-2,r:0,dr:Math.random()-.5,color:`hsl(${360*Math.random()},100%,50%)`})},15)}})();
</script>

</body>
</html>
