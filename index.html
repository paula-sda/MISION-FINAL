<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Unir Puntos - Constelación Mathema</title>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
      font-family: 'Quicksand', sans-serif;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      touch-action: none;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      padding: 2rem;
      border-radius: 1rem;
      text-align: center;
      color: white;
      z-index: 10;
      display: none;
      width: 90%;
      max-width: 300px;
    }

    .modal h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .modal p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .modal button {
      background: #f9b642;
      color: black;
      border: none;
      padding: 0.8rem 1.5rem;
      font-family: 'Orbitron Black', sans-serif;
      font-size: 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }

    @keyframes blink {
      0%, 50%, 100% { color: red; }
      25%, 75% { color: darkred; }
    }

    .error h1 {
      animation: blink 1s infinite;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>

<div class="modal" id="modal">
  <h1 id="modalTitle"></h1>
  <p id="modalMessage"></p>
  <button onclick="location.reload()">Reintentar</button>
</div>

<script>
// Coordenadas de los puntos (en % relativas para que sea responsive)
const points = [
  {x:50, y:5},
  {x:62, y:35},
  {x:95, y:35},
  {x:68, y:55},
  {x:78, y:90},
  {x:50, y:70},
  {x:22, y:90},
  {x:32, y:55},
  {x:5, y:35},
  {x:38, y:35},
  {x:50, y:5} // Vuelve al inicio para cerrar
];

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
resizeCanvas();

let path = [];
let completed = false;
let correctSequence = [...Array(points.length).keys()]; // [0,1,2,3...]

// EVENTOS
canvas.addEventListener('pointerdown', handleClick);
window.addEventListener('resize', resizeCanvas);

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Dibujar líneas ya unidas
  ctx.lineWidth = 2;
  ctx.strokeStyle = completed ? '#ff00ff' : 'white'; // Rosa si completado
  ctx.beginPath();
  for (let i = 0; i < path.length; i++) {
    let p = getPoint(path[i]);
    if (i === 0) ctx.moveTo(p.x, p.y);
    else ctx.lineTo(p.x, p.y);
  }
  ctx.stroke();

  // Dibujar puntos
  points.forEach((pt, i) => {
    const pos = getPoint(i);
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, 8, 0, Math.PI * 2);
    ctx.fillStyle = 'white';
    ctx.fill();
    ctx.shadowColor = '#00ffff';
    ctx.shadowBlur = 10;
    ctx.strokeStyle = 'white';
    ctx.stroke();
    ctx.shadowBlur = 0;

    // Número del punto
    ctx.fillStyle = 'white';
    ctx.font = 'bold 14px Quicksand';
    ctx.fillText(i + 1, pos.x - 4, pos.y + 4);
  });
}

function getPoint(index) {
  return {
    x: points[index].x / 100 * canvas.width,
    y: points[index].y / 100 * canvas.height
  };
}

function handleClick(e) {
  if (completed) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  let nearest = -1;
  let minDist = 20;

  points.forEach((pt, i) => {
    const p = getPoint(i);
    const dx = p.x - x;
    const dy = p.y - y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if (dist < minDist) {
      nearest = i;
      minDist = dist;
    }
  });

  if (nearest !== -1 && !path.includes(nearest)) {
    path.push(nearest);
    draw();

    if (path.length === points.length) {
      checkSequence();
    }
  }
}

function checkSequence() {
  let correct = true;
  for (let i = 0; i < path.length; i++) {
    if (path[i] !== correctSequence[i]) {
      correct = false;
      break;
    }
  }
  if (correct) {
    animateLine();
    showModal(true);
    launchConfetti();
  } else {
    showModal(false);
  }
}

function animateLine() {
  completed = true;
  let progress = 0;
  const interval = setInterval(() => {
    progress += 0.05;
    if (progress >= 1) {
      clearInterval(interval);
      draw();
    }
    ctx.strokeStyle = `hsl(300,100%,${50+progress*50}%)`;
    draw();
  }, 50);
}

function showModal(success) {
  setTimeout(() => {
    const modal = document.getElementById('modal');
    const title = document.getElementById('modalTitle');
    const message = document.getElementById('modalMessage');
    if (success) {
      title.textContent = '¡Misión completada con éxito!!';
      message.textContent = 'La constelación Mathema reactivada';
    } else {
      modal.classList.add('error');
      title.textContent = 'ERROR';
      message.textContent = 'La constelación Mathema no reactivada';
    }
    modal.style.display = 'block';
  }, 1000);
}

// Confeti sencillo
function launchConfetti() {
  const confetti = [];
  for (let i = 0; i < 100; i++) {
    confetti.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 6 + 2,
      dx: (Math.random() - 0.5) * 2,
      dy: Math.random() * 2 + 2,
      color: `hsl(${Math.random()*360},100%,50%)`
    });
  }
  function animate() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    draw();
    confetti.forEach(c => {
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
      ctx.fillStyle = c.color;
      ctx.fill();
      c.x += c.dx;
      c.y += c.dy;
      if (c.y > canvas.height) c.y = 0;
      if (c.x > canvas.width) c.x = 0;
      if (c.x < 0) c.x = canvas.width;
    });
    requestAnimationFrame(animate);
  }
  animate();
}
</script>

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Quicksand:wght@700&display=swap" rel="stylesheet">

</body>
</html>

